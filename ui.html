<script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.17/Tone.js"></script>
<h2>Rectangle Creator</h2>
<p>Count: <input id="count" value="5"></p>
<button id="create">Create swag</button>
<button id="cancel">Cancel</button>
<script>
  onmessage = (event) => {

    let nodes = event.data.pluginMessage
    let tones = ["C", "D", "E", "F", "G", "A", "B"]
    const synth = new Tone.Synth().toDestination();
    const now = Tone.now()
    synth.volume.value = -8;


    for (let i = 0; i <= event.data.pluginMessage.length; i++) {
      if (event.data.pluginMessage[i][0] != undefined) {
        synth.triggerAttackRelease(level2Synth(nodes[i][0], tones), "16n", now + i / 4)
      }
    }
  }

  function level2Synth(level, tones) {
    let number;
    let letter = level % 7;
    if (letter == 0) {
      letter = 7
    }
    letter--;

    if (level <= 7) {
      number = 4;
    } else if (level >= 8 && level <= 13) {
      number = 5;
    } else if (level >= 14 && level <= 19) {
      number = 6;
    } else if (level >= 20 && level <= 25) {
      number = 7;
    } else if (level >= 26 && level <= 31) {
      number = 8;
    } else {
      number = 9;
    }

    console.log(tones[letter] + number)

    return (tones[letter] + number);

  }


  document.getElementById('create').onclick = () => {
    const textbox = document.getElementById('count');
    const count = parseInt(textbox.value, 10);
    parent.postMessage({
      pluginMessage: {
        type: 'create-rectangles',
        count
      }
    }, '*')
  }

  document.getElementById('cancel').onclick = () => {
    parent.postMessage({
      pluginMessage: {
        type: 'cancel'
      }
    }, '*')
  }
</script>